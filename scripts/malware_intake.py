import os
import glob
import datetime

MAL_ROOT = "E:\\"

for entry_name in os.listdir(MAL_ROOT):
    entry_p = os.path.join(MAL_ROOT, entry_name)

    if os.path.isdir(entry_p):
        continue

    # Get current date as YYYY-MM-DD
    current_date = datetime.date.today().strftime("%Y-%m-%d")

    # Get all folders that already contain this date
    glob_pattern = f"{current_date}_*"
    folders = glob.glob(glob_pattern, recursive=False, root_dir=MAL_ROOT)
    index = len(folders) + 1

    file_key = entry_name

    new_folder_name = f"{current_date}_{index}_{file_key}"
    new_folder_p = os.path.join(MAL_ROOT, new_folder_name)

    os.mkdir(new_folder_p)
    os.rename(entry_p, os.path.join(new_folder_p, entry_name))
